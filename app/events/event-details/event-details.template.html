<ScrollView class="cntnr">
    <ActionBarExtension>
        <NavigationButton *ngIf="isAndroid" android.systemIcon="ic_menu_back" (tap)="onBack()"></NavigationButton>
        <ActionItem *ngIf="!isAndroid" ios.systemIcon="1" ios.position="left" (tap)="onBack()">
            <label text="Back"></label>
        </ActionItem>
        <ActionItem>
            <Label [text]="event && event.Name" textWrap="true"></Label>
        </ActionItem>
        <ActionItem (tap)="onEdit()" *ngIf="canEdit()"
            ios.systemIcon="2" android.systemIcon="ic_menu_edit"
            ios.position="right">
        </ActionItem>
    </ActionBarExtension>

    <StackLayout *ngIf="event">
        <photo-picker [url]="event.ImageUrl" [type]="'event'"></photo-picker>

        <StackLayout class="info-container">
            <Button *ngIf="!alreadyRegistered && !isPastEvent && event.OpenForRegistration && !event.RegistrationCompleted" text="Register" (tap)="register()" class="btn btn-primary"></Button>

            <StackLayout class="info-wrapper">
                <GridLayout columns="auto, auto, *" rows="auto, auto">
                    <Label class="info-label" text="Date" col="0" row="0"></Label>
                    <Label class="info-label tbd" *ngIf="!event.EventDate" text="(TBD)" col="1" row="0"></Label>
                    <Image class="info-icon" src="http://icons.iconarchive.com/icons/martz90/circle/256/calendar-icon.png" col="2" row="0"></Image>
                </GridLayout>
                <Label class="info-value" *ngFor="let date of (event.EventDateChoices || [])" [text]="date | date:dateFormat"></Label>
                <Label class="info-value" *ngIf="event.EventDate" [text]="event.EventDate | date:dateFormat"></Label>
                <Button *ngIf="!event.EventDate" [nsRouterLink]="['/events/' + event.Id + '/date-choices']" text="Choices"></Button>
            </StackLayout>

            <StackLayout class="info-wrapper">
                <Label class="info-label" text="Description"></Label>
                <Label class="info-value" [text]="event.Description" [textWrap]="true"></Label>
            </StackLayout>

            <StackLayout class="info-wrapper">
                <GridLayout columns="auto, *">
                    <Label class="info-label" text="Location" col="0"></Label>
                    <Image *ngIf="event.LocationURL" class="info-icon" (tap)="showLocation()" src="https://cdn2.iconfinder.com/data/icons/circle-icons-1/64/gps-128.png" col="1"></Image>
                </GridLayout>
                <Label class="info-value" [text]="event.LocationName" [textWrap]="true"></Label>
            </StackLayout>

            <StackLayout class="info-wrapper">
                <Label class="info-label" text="Group"></Label>
                <Label class="info-value" [text]="event.Group"></Label>
            </StackLayout>

            <StackLayout class="info-wrapper">
                <Label class="info-label" text="Organizer"></Label>
                <Label class="info-value" [text]="event.Organizer.DisplayName || event.Organizer.Username"></Label>
            </StackLayout>

            <StackLayout class="info-wrapper no-separator">
                <Label class="info-label" text="Registered Participants"></Label>

                <WrapLayout *ngIf="registeredUsers.length > 0 && !registeredUsersExpanded" class="registered-users-wrapper" orientation="horizontal">
                    <photo-picker *ngFor="let user of registeredUsers.slice(0, 3)" [url]="user.ImageUrl" [type]="'user'" [small]="true"></photo-picker>

                    <StackLayout orientation="horizontal" (tap)="toggleExpandedUsers()" class="expandable">
                        <Label class="info-value" *ngIf="remainingUsersCount" [text]="' and ' + remainingUsersCount + ' more'"></Label>
                        <Label class="info-value" [text]="(registeredUsers.length === 1 ? 'is' : 'are') + ' going'"></Label>
                    </StackLayout>
                </WrapLayout>

                <Label class="info-value" *ngIf="registeredUsersExpanded" (tap)="collapseExpandedUsers()" [text]="getAllRegisteredUserNames()" [textWrap]="true"></Label>
                <Label class="info-value" *ngIf="registeredUsers.length === 0" [text]="'No one has registered for this event.'"></Label>
            </StackLayout>

        </StackLayout>
    </StackLayout>

    <ActivityIndicator [busy]="!event" [visibility]="event ? 'collapse' : 'visible'" horizontalAlignment="center" verticalAlignment="center"></ActivityIndicator>

</ScrollView>
