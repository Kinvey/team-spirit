<StackLayout>
    <ScrollView class="cntnr">
        <ActionBarExtension>
            <NavigationButton *ngIf="isAndroid" icon="res://icon_back" (tap)="onBack()"></NavigationButton>
            <ActionItem *ngIf="!isAndroid" ios.systemIcon="1" ios.position="left" (tap)="onBack()">
                <label text="Back"></label>
            </ActionItem>
            <ActionItem *ngIf="canEdit()" (tap)="onEdit()" ios.position="right">
                <StackLayout>
                    <Label class="button if" text="&#x65;"></Label>
                </StackLayout>
            </ActionItem>

            <ActionItem *ngIf="isAndroid" [visibility]="showIf(canChangeVote())" (tap)="changeVote()" text="Change Date Vote" android.position="popup"></ActionItem>
            <ActionItem *ngIf="isAndroid" [visibility]="showIf(canUnregister())" (tap)="unregister()" text="Unregister" android.position="popup"></ActionItem>
            <ActionItem *ngIf="isAndroid" [visibility]="showIf(canEdit())" (tap)="deleteEvent()" text="Delete Event" android.position="popup"></ActionItem>

            <ActionItem (tap)="toggleActions()" *ngIf="!isAndroid && (canChangeVote() || canUnregister() || canEdit())">
                <StackLayout>
                    <Label class="button if" text="&#x66;"></Label>
                </StackLayout>
            </ActionItem>
        </ActionBarExtension>

        <StackLayout *ngIf="event">
            <AbsoluteLayout width="100%" height="200">
                <StackLayout left="0" top="0" width="100%" height="200" class="user">
                    <photo-picker [url]="event.ImageUrl" [type]="'event'" [noImageIcon]="'&#x77;'" [noImageText]="'No image available'"></photo-picker>
                </StackLayout>
                <StackLayout left="0" top="20" height="40">
                    <Label *ngIf="alreadyRegistered" text="Registered" class="registered-label"></Label>
                </StackLayout>
            </AbsoluteLayout>

            <StackLayout class="info-container">
                <Label *ngIf="canRegister()" text="Register" (tap)="register()" class="btn btn-primary"></Label>

                <StackLayout class="info-wrapper">
                    <GridLayout columns="auto, auto, *" rows="auto, auto">
                        <Label class="info-label" text="Date" col="0" row="0"></Label>
                        <Label class="info-label tbd" *ngIf="!event.EventDate" text="(TBD)" col="1" row="0"></Label>
                        <Label class="info-icon if" text="&#x78;" col="2" row="0"></Label>
                    </GridLayout>
                    <StackLayout orientation="horizontal" *ngFor="let date of (event.EventDateChoices || [])">
                        <Label *ngIf="alreadyRegistered && userVotedForDate(date)" text="&#x68;" class="vote yes if"></Label>
                        <Label *ngIf="alreadyRegistered && !userVotedForDate(date)" text="&#x67;" class="vote no if"></Label>
                        <Label class="info-value" [text]="date | date:dateFormat"></Label>
                        <Label class="votes-count" *ngIf="countsInitialized()" [text]="getVoteText(date)"></Label>
                    </StackLayout>
                    <Label class="info-value" *ngIf="event.EventDate" [text]="event.EventDate | date:dateFormat"></Label>
                </StackLayout>

                <StackLayout class="info-wrapper">
                    <Label class="info-label" text="Description"></Label>
                    <Label class="info-value" [text]="event.Description" [textWrap]="true"></Label>
                </StackLayout>

                <StackLayout class="info-wrapper">
                    <GridLayout columns="auto, *">
                        <Label class="info-label" text="Location" col="0"></Label>
                        <Label *ngIf="event.LocationURL" class="info-icon if" text="&#x74;" (tap)="showLocation()" col="1"></Label>
                    </GridLayout>
                    <Label class="info-value" [text]="event.LocationName" [textWrap]="true"></Label>
                </StackLayout>

                <StackLayout class="info-wrapper">
                    <Label class="info-label" text="Group"></Label>
                    <Label class="info-value" [text]="event.Group"></Label>
                </StackLayout>

                <StackLayout class="info-wrapper organizer">
                    <Label class="info-label" text="Organizer"></Label>
                    <user-display [users]="event.Organizer" [showNames]="true"></user-display>
                </StackLayout>

                <StackLayout class="info-wrapper no-separator">
                    <Label class="info-label" text="Registered Participants"></Label>
                    <GridLayout columns="auto, *" *ngIf="registeredUsers.length > 0" (tap)="onParticipantsTap()" class="registered-users-wrapper">
                        <StackLayout orientation="horizontal" col="0" class="user-display-wrp">
                            <user-display [users]="registeredUsers" [withImages]="3" class="user-display"></user-display>
                            <Label class="info-value going-label" [text]="(registeredUsers.length === 1 ? 'is' : 'are') + ' going'"></Label>
                        </StackLayout>
                        <Label class="info-icon if" text="&#x64;" col="1"></Label>
                    </GridLayout>

                    <Label class="info-value" *ngIf="registeredUsers.length === 0" [text]="'No one has registered for this event.'"></Label>
                </StackLayout>
            </StackLayout>
        </StackLayout>

        <ScrollView>
            <ActivityIndicator [busy]="!event" [visibility]="event ? 'collapse' : 'visible'" horizontalAlignment="center" verticalAlignment="center"></ActivityIndicator>
        </ScrollView>
    </ScrollView>
</StackLayout>